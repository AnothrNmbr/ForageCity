var myScroll,fixScroll,tm=false,top_btn=false,back1,back2,back=0,keyTO,debug,debug_input,debug_xhr,debug_result,hu=HOME_URL,map,sll=false,zm=false,slat,slong,scrollOff=false,hasTouch="ontouchstart" in window,tbtm=false,iOS=true,taplock=false,tlTO,lastgn,ff=false,perListPage=20,geoLoc=false,defaultSort="wishlist",extras,pixrat=(navigator.userAgent.match(/ADR6300/i)?0.75:1),backHelper=function(){};fixFooter=function(){if(!iOS){var a=document.body.scrollTop||document.documentElement.scrollTop;if(a==0&&jQuery("#scroll-wrapper").height()>jQuery("body").height()){jQuery("#footer").css("display","none");setTimeout('window.scrollTo(0,1);setTimeout("fixFooter();",50);',250);}else{jQuery("#footer").css({position:"absolute",top:(Math.ceil(a*pixrat)+jQuery(window).height())+"px",bottom:"auto",display:"block"});}}},fixScrollWrapper=function(){if(!iOS){jQuery("#scroll-wrapper").css({"min-height":(jQuery(window).height()-125)+"px","padding-bottom":"50px"});}},refreshiScroll=function(){window.scrollTo(0,1);if(iOS){if(scrollOff){myScroll.disable();}else{myScroll.enable();}myScroll.scrollTo(0,0,0);setTimeout(function(){myScroll.refresh();},5);}else{fixFooter();}},hideStuff=function(){if(!iOS){jQuery("#content").add(".search-bar").add("ul.submenu").hide();}},showStuff=function(){var a=250;if(iOS){a=0;}setTimeout('jQuery("#content").add(".search-bar").add("ul.submenu").show();refreshiScroll();',a);},showMore=function(a){jQuery(".list-page-"+a).removeClass("hidden");a++;if(jQuery(".list-page-"+a).length>0){jQuery("#show_more").attr("onclick","showMore("+a+");");}else{jQuery("#show_more").remove();}},loadLocationAndReverse=function(a){geoLoc=false;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(c){geoLoc=c.coords;if(a){var b=a.parent(),d=new google.maps.Geocoder(),e=new google.maps.LatLng(c.coords.latitude,c.coords.longitude);a.val("current location");b.children("span").addClass("explanation-hidden");b.append("<input type='hidden' name='latitude' value='"+c.coords.latitude+"' />");b.append("<input type='hidden' name='longitude' value='"+c.coords.longitude+"' />");d.geocode({latLng:e},function(g,f){if(f==google.maps.GeocoderStatus.OK){if(g[0]){a.val(g[0].formatted_address);}}});}},function(){});return true;}return false;},loadLocation=function(b,a){if(geoLoc){if(b){b(geoLoc);}return true;}geoLoc=false;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(c){geoLoc=c.coords;if(b){b(geoLoc);}},function(){if(a){a();}});return true;}return false;},addToMap=function(h,g,d,c,f,e,b){var a=new google.maps.Marker({position:new google.maps.LatLng(g,d),title:f});a.setMap(h);google.maps.event.addListener(a,"click",function(){data={action:"fc_load_find",subaction:"box_detail",box_post:c};get_wp_data("GET",data);backHelper=function(){sll=h.getCenter();zm=h.getZoom();get_wp_data(e,b);};});},addBackButton=function(){if(jQuery("div#back-button").length==0){jQuery("#scroll-wrapper").before('<div id="back-button"><input type="submit" name="back" value="Back"></div>');}jQuery("div#container").addClass("with-back-button");},animateNotice=function(a){var b=jQuery("p.finalized-notice");b.animate({height:a,padding:"4px"},300);setTimeout(function(){b.animate({height:0},256,function(){b.animate({padding:0},44,function(){b.remove();});});},5000);},get_wp_data_with_loc=function(a,b){get_wp_data(a,b);if(geoLoc){console.log(geoLoc);b.latitude=geoLoc.latitude;b.longitude=geoLoc.longitude;get_wp_data(a,b);}else{if(!loadLocation(function(c){console.log(c);b.latitude=c.latitude;b.longitude=c.longitude;get_wp_data(a,b);},function(){console.log("no location");get_wp_data(a,b);})){get_wp_data(a,b);}}},get_wp_data=function(b,a,c){if(c==undefined){c=0;}backHelper=function(){};a.timestamp=(new Date).getTime();debug_input=a;lastgn=a.good_name;jQuery("body").addClass("loading-ajax");jQuery.ajax({url:ADMIN_AJAX_URL,type:b,data:a,error:function(f,d,e){if(c>5){jQuery("body").removeClass("loading-ajax");alert("I had trouble communicating with the server. Wait a bit and then try again.");}else{get_wp_data(b,a,c+1);}},success:function(ap,M,ar){if(jQuery(ap).find("redirect").text()!=""){window.location=jQuery(ap).find("redirect").text();}fixFooter();debug=ap;debug_result=M;debug_xhr=ar;jQuery("body").removeClass("loading-ajax");jQuery("div#top-buttons").removeClass("homemenu page");var aq=jQuery(ap),g=jQuery("div#content"),q=jQuery("#scroll-wrapper"),am=aq.find("error"),aj=jQuery("p.error-message"),ab=aq.find("message").text(),C=jQuery("#nav-menu a[title=find]"),A=jQuery("#nav-menu a[title=give]"),F=jQuery("#nav-menu a[title=basket]"),t=jQuery("#nav-menu a[title=profile]"),r=a.good_name,s=a.location,S=(a.sort_by=="map"),Z=aq.find("box"),p=Z,Q=aq.find("good"),ae=aq.find("reservation"),P=ae,ad="nearby",j=false,z="",B="",k=0,E=0,al=0,T,D,N,o,X,V,Y,ai,f,O,G,h,ac,K,m,W,e,ah,v,af,ag,aa,n,I,J,l,R,U,H,L,ak,an,x,y,w,ao;hideStuff();if(a.action=="fc_load_find"){if(a.subaction=="get_list"){if(a.good_name==lastgn){back=0;g.html("");jQuery("#back-button").remove();if(!C.is(".current")){jQuery("#nav-menu a").removeClass("current");C.addClass("current");}if(!jQuery("body").is(".with-submenu-and-bar")){if(a.sort_by=="map"){ad="nearby";}else{if(a.sort_by=="nearby"){ad="map";}}jQuery("div.search-bar").remove();jQuery("ul.submenu").remove();jQuery("div#scroll-wrapper").before('<div id="good-type-search" class="find search-bar"><form action="'+hu+'/find/" method="post"><input type="text" name="good_name" value=""><input type="submit" value="Search"></form></div>');X='<ul class="submenu"><li id="sort-by-wishlist"';if(a.sort_by=="wishlist"){X+=' class="current"';}X+='><a href="'+hu+'/find/wishlist/">Wishlist</a></li><li id="sort-by-recent"';if(a.sort_by=="recent"){X+=' class="current"';}X+='><a href="'+hu+'/find/recent/">Recent</a></li><li id="sort-by-'+ad+'"';if(a.sort_by=="map"||a.sort_by=="nearby"){X+=' class="current"';}X+='><a href="'+hu+"/find/"+ad+'/">Nearby/Map</a></li></ul>';jQuery("div#scroll-wrapper").before(X);jQuery("body").addClass("with-bar with-submenu with-submenu-and-bar");}if(a.clean_slate=="true"){jQuery("div#good-type-search input[name=good_name]").val("");}if(a.note=="show"){g.append("<p class='finalized-notice'>It's all yours! Visit your basket when you're ready to pick it up.</p>");animateNotice("2.5em");}if(S){slat=aq.find("search_location").find("latitude").text();slong=aq.find("search_location").find("longitude").text();if(slat==""||slong==""){slat=37.831866;slong=-122.2824592;}g.append("<div id='mapdiv'></div>");jQuery("div#mapdiv").css("height",(jQuery(window).height()-185)+"px");if(sll){f=sll;}else{f=new google.maps.LatLng(slat,slong);}if(zm){ai=zm;}else{ai=14;}map=new google.maps.Map(document.getElementById("mapdiv"),{zoom:ai,center:f,mapTypeId:google.maps.MapTypeId.ROADMAP});zm=false;sll=false;scrollOff=true;}if(Z.length>0){Z.each(function(){E=Math.floor(k/perListPage);if(k%perListPage>0&&!S){g.append('<p class="separating-line list-page-'+E+z+'"></p>');}j=true;var u=jQuery(this),at=u.find("good").find("name").text()+": "+u.find("quantity_str").text(),i=u.children("id").text(),d='<div class="box-o-goods find-box list-page-'+E+z+'"><div class="box-pic">'+u.find("pic").text()+'</div><div class="box-info"><form action="'+hu+'/find/" method="post"><input type="hidden" name="searched" value="'+a.good_name+'"><input type="hidden" name="box_post" value="'+i+'"><input type="hidden" name="action" value="box_detail"><p>'+at+"<br>"+u.find("location_str").text()+"<span>"+u.find("distance").text()+' mi</span> <input type="submit" value="claim"></p></form></div></div>';if(S){addToMap(map,u.find("latitude").text(),u.find("longitude").text(),i,at,b,a);}else{g.append(d);k++;if(k>=perListPage){z=" hidden";}}});if(!S&&Z.length>perListPage){g.append("<p class='separating-line'</p><p><a id='show_more' onclick='showMore(1);'>Show More</a></p>");}}else{if(Q.length>0){g.append("<p class='notice'>Nobody's sharing anything like that right now. You can try adding a good to your wishlist to make it easier to find the next time someone shares some.</p>");aq.find("good").each(function(){var i=jQuery(this),d=i.find("name").text(),u=i.find("id").text(),at='<div class="box-o-goods find-good-box"><div class="box-pic">'+i.find("pic").text()+'</div><div class="box-info"><form action="'+hu+'/find/" id="wishlist_form_'+u+'" method="post"><input type="hidden" name="action" value="';if(i.find("in_wishlist").text()=="false"){at+='add_to_wishlist"><input type="hidden" name="good_type" value="'+u+'"><p>'+d+'<span>+</span><input id="add_to_wishlist" type="submit" value="+"></p></form></div></div>';}else{at+='remove_from_wishlist"><input type="hidden" name="good_type" value="'+u+'"><p>'+d+'<span>-</span><input id="remove_from_wishlist" type="submit" value="-"></p></form></div></div>';}g.append(at);});}else{if(a.sort_by=="wishlist"){if(aq.find("no_wishlist").text()=="true"){g.append("<p class='notice'>Thereâ€™s nothing on your wishlist right now. You can add a good to your wishlist to make it easier to find the next time someone shares that item.</p>");}else{if(aq.find("empty_wishlist").text()=="true"){g.append("<p class='notice'>Nobody's sharing anything on your wishlist right now. Check out what people have shared recently or nearby instead.</p>");}}}}}}else{}}else{if(a.subaction=="box_detail"){back=1;back1={bar:jQuery("div.search-bar").clone(),submenu:jQuery("ul.submenu").clone(),contentHTML:jQuery("#content").html()};addBackButton();h=p.find("instructions").text();K=p.find("affiliation").text();jQuery("div.search-bar").remove();jQuery("ul.submenu").remove();jQuery("body").removeClass("with-bar with-submenu with-submenu-and-bar");V='<div class="box-to-claim"><div class="box-pic">'+p.find("pic").text()+"</div>";if(p.find("in_wishlist").text()=="false"){V+='<form action="'+hu+'/find/" id="wishlist_form" method="post"><input type="hidden" name="action" value="add_to_wishlist"><input type="hidden" name="box_post" value="'+p.find("id").text()+'"><input type="hidden" name="good_type" value="'+p.find("good_type").text()+'"><input id="add_to_wishlist" type="submit" value="Add '+p.find("good_name").text()+' to wishlist"></form>';}else{V+='<form action="'+hu+'/find/" id="wishlist_form" method="post"><input type="hidden" name="action" value="remove_from_wishlist"><input type="hidden" name="box_post" value="'+p.find("id").text()+'"><input type="hidden" name="good_type" value="'+p.find("good_type").text()+'"><input id="remove_from_wishlist" type="submit" value="Remove '+p.find("good_name").text()+' from wishlist"></form>';}V+='<div class="box-info"><p>'+p.find("good_name").text()+": "+(p.find("quantity_str").text())+"</p><p>Given by "+p.find("giver").text();if(K+=""){V+=" via "+K;}V+='</p></div><div class="box-info"><h3>Pickup location</h3><p>'+p.find("location").text()+"</p>";if(h!=""){V+="<h3>Instructions</h3><p>"+h+"</p>";}V+='</div><div class="take-it"><form action="'+hu+'/find/" method="post"><input type="hidden" name="box_post" value="'+p.find("id").text()+'"><input type="hidden" name="action" value="finalize"><input type="hidden" name="available_quantity" value="'+p.find("quantity").text()+'"><p class="label">Quantity</p><p><span class="explanation">How many are you taking?</span><input type="number" id="claim_quantity" name="claim_quantity" value=""></p><input id="reserve_lot" type="submit" value="Reserve this lot"></form></div>';V+='<br><div id="comments">';p.find("comment").each(function(){V+="<p class='comment'><strong>"+jQuery(this).find("user").text()+'</strong> says "'+jQuery(this).find("content").text()+'"</p>';});V+="</div></div>";g.html(V);}else{if(a.subaction=="add_to_wishlist"){if(aq.find("added").text()=="true"){T=jQuery("form#wishlist_form");if(T.length>0){D=T.find("input#add_to_wishlist");if(D.length>0){D.attr("value",D.attr("value").replace("Add","Remove").replace(" to wishlist"," from wishlist"));}}else{T=jQuery("form#wishlist_form_"+a.good_type);D=T.find("input#add_to_wishlist");if(D.length>0){D.attr("value","-");}}T.find("input[name=action]").attr("value","remove_from_wishlist");T.find("span").replaceWith("<span>-</span>");if(D.length>0){D.attr("id","remove_from_wishlist");}}}else{if(a.subaction=="remove_from_wishlist"){if(aq.find("removed").text()=="true"){T=jQuery("form#wishlist_form");if(T.length>0){D=T.find("input#remove_from_wishlist");if(D.length>0){D.attr("value",D.attr("value").replace("Remove","Add").replace(" from wishlist"," to wishlist"));}}else{T=jQuery("form#wishlist_form_"+a.good_type);D=T.find("input#remove_from_wishlist");if(D.length>0){D.attr("value","+");}}T.find("input[name=action]").attr("value","add_to_wishlist");T.find("span").replaceWith("<span>+</span>");if(D.length>0){D.attr("id","add_to_wishlist");}}}else{if(a.subaction=="reserve"){if(am.length==0){ap={action:"fc_load_find",subaction:"get_list",note:"show",sort_by:"wishlist",clean_slate:"true"};get_wp_data("GET",ap);}else{if(aj.length==0){jQuery("input#reserve_lot").before("<p class='error-message'></p>");aj=jQuery("p.error-message");}aj.html(ab);}}}}}}}else{if(a.action=="fc_load_basket"){if(a.subaction=="get_list"){back=0;g.html("");jQuery("div.search-bar").remove();jQuery("ul.submenu").remove();jQuery("#back-button").remove();jQuery("body").removeClass("with-bar with-submenu with-submenu-and-bar");if(a.note=="taken"){g.append("<p class='finalized-notice'>You got it!</p>");animateNotice("1.25em");}if(a.note=="released"){g.append("<p class='finalized-notice'>Your reservation has been canceled.</p>");animateNotice("1.25em");}if(a.note=="flagged"){g.append("<p class='finalized-notice'>The box has been flagged.</p>");animateNotice("1.25em");}if(!F.is(".current")){jQuery("#nav-menu a").removeClass("current");F.addClass("current");}if(jQuery("div#pickup-notice").length==0){g.prepend("<div id='pickup-notice'><h2>ITEMS THAT I NEED TO PICK UP</h2><p class='basket_count'>"+ae.length+"</p></div>");}if(ae.length>0){ae.each(function(){if(j){g.append('<p class="separating-line"></p>');}j=true;var i=jQuery(this),d='<div class="box-o-goods basket-box"><div class="box-pic">'+i.find("pic").text()+'</div><div class="box-info"><form action="'+hu+'/basket/" method="post"><input type="hidden" name="reservation" value="'+i.find("res_ID").text()+'" /><input type="hidden" name="box_post" value="'+i.find("box").children("id").text()+'"><input type="hidden" name="action" value="take"><p>'+i.find("box").find("good_name").text()+": "+i.find("quantity_str").text()+"<br>"+i.find("location_str").text()+i.find("expiration").text()+'<input type="submit" value="Take"></p></form></div></div>';g.append(d);});}}else{if(a.subaction=="get_detail"){back=1;back1={contentHTML:jQuery("#content").html(),submenu:false,bar:false};addBackButton();h=P.find("instructions").text();v=P.find("id").text();jQuery("div#pickup-notice").remove();jQuery("body").removeClass("with-bar with-submenu with-submenu-and-bar");V='<div class="box-to-claim"><div class="box-pic">'+P.find("pic").text()+'</div><div class="box-info right"><p>'+P.find("good_name").text()+": "+P.find("quantity_str").text()+"</p><p>Given by "+P.find("giver").text()+'</p></div><div class="box-info"><h3>Pickup location</h3><p>'+P.find("location").text()+"</p>";if(h!=""){V+="<h3>Instructions</h3><p>"+h+"</p>";}V+='</div><div class="pickup"><form action="'+hu+'/basket/" method="post"><input type="hidden" name="reservation" value="'+v+'"><input type="hidden" name="claim_quantity" value="'+P.find("quantity").text()+'"><input type="hidden" name="action" value="finalize"><input type="hidden" name="box_post" value="'+P.find("box_post").text()+'">'+P.find("quantity_input").text()+'<p>Once you see the items, please enter the code to check them out.</p><input type="number" class="box-number" size="5" name="box_number" min="0" max="99999" step="1" value=""><input type="submit" id="take_lot" value="I\'m taking this!"></form></div><form action="'+hu+'/basket/" id="reservation-release-form" method="post"><input type="hidden" name="reservation" value="'+v+'"><input type="hidden" name="action" value="release"><input type="submit" value="Release these goods."></form><form action="'+hu+'/basket/" id="reservation-problem-form" method="post"><p class="label">Something wrong?</p><input type="hidden" name="reservation" value="'+v+'" /><input type="hidden" name="action" value="flag" /><p><input type="radio" name="problem" value="missing" />Nothing here</p><p><input type="radio" name="problem" value="rotten" />The items are rotten</p><p><input type="radio" name="problem" value="other" onchange="if(jQuery(\'input:radio[name=problem]:checked\').val()==\'other\'){jQuery(\'#other_problem\').removeAttr(\'disabled\');jQuery(\'#other_problem\').focus()}else jQuery(\'#other_problem\').attr(\'disabled\',\'disabled\');" /><span class="explanation">Other</span><input type="text" name="other_problem" id="other_problem" disabled="disabled" /></p><input type="submit" value="Flag this box" /></form></div>';g.html(V);}else{if(a.subaction=="take"){if(am.length==0){ap={action:"fc_load_basket",subaction:"get_list",note:"taken"};get_wp_data("GET",ap);}else{if(aj.length==0){jQuery("input#take_lot").before("<p class='error-message'></p>");aj=jQuery("p.error-message");}aj.html(ab);}}else{if(a.subaction=="release"){if(am.length==0){ap={action:"fc_load_basket",subaction:"get_list",note:"released"};get_wp_data("GET",ap);}else{if(aj.length==0){jQuery("input#take_lot").before("<p class='error-message'></p>");aj=jQuery("p.error-message");}aj.html(ab);}}else{if(a.subaction=="flag"){if(am.length==0){ap={action:"fc_load_basket",subaction:"get_list",note:"flagged"};get_wp_data("GET",ap);}else{if(aj.length==0){jQuery("input#other_problem").after("<p class='error-message'></p>");aj=jQuery("p.error-message");}aj.html(ab);}}}}}}}else{if(a.action=="fc_load_give"){if(a.subaction=="get_list"){ah=aq.find("exact").text();back=0;g.html("");jQuery("#back-button").remove();if(!A.is(".current")){jQuery("#nav-menu a").removeClass("current");A.addClass("current");}if(!jQuery("body").is(".with-bar")||jQuery("body").is(".with-submenu")){jQuery("div.search-bar").remove();jQuery("ul.submenu").remove();jQuery("div#scroll-wrapper").before('<div id="good-type-search" class="give search-bar"><form action="'+hu+'/give/" method="post"><input type="text" name="good_name" value=""><input type="submit" value="Search"></form></div>');jQuery("body").addClass("with-bar").removeClass("with-submenu with-submenu-and-bar");}if(a.clean_slate=="true"){jQuery("div#good-type-search input[name=good_name]").val("");}if(a.note=="show"){g.append("<p class='finalized-notice'>Box shared.<br />Got anything else to share?</p>");animateNotice("2.5em");}if(ah=="false"&&r!=undefined&&r!=""){g.append('<div id="create-good-type"><form action="'+hu+'/give/" method="post"><input type="hidden" name="good_name" value="'+r+'" /><input type="hidden" name="action" value="create_good_type" /><input type="submit" value=\'Add "'+r+"\"' /></form></div>");}if(Q.length>0){Q.each(function(){E=Math.floor(k/perListPage);if(k%perListPage>0){g.append('<p class="separating-line list-page-'+E+z+'"></p>');}j=true;V='<div class="box-o-goods give-box list-page-'+E+z+'"><div class="box-pic">'+jQuery(this).find("pic").text()+'</div><div class="box-info"><form action="'+hu+'/give/" method="post" class="good-type-list"><input type="hidden" name="good_type_post" value="'+jQuery(this).find("good_type").text()+'" /><input type="hidden" name="good_name" value="'+jQuery(this).find("name").text()+'"><input type="hidden" name="action" value="box_details"><p>'+jQuery(this).find("name").text()+'	<input type="submit" value=""></p></form></div></div>';g.append(V);k++;if(k>=perListPage){z=" hidden";}});}if(Q.length>perListPage){g.append("<p class='separating-line'</p><p><a id='show_more' onclick='showMore(1);'>Show More</a></p>");}}else{if(a.subaction=="create_box_post"){O=aq.find("lat").text();G=aq.find("long").text();Y=aq.find("pic").text();af=aq.find("post").text();ag=aq.find("box_number").text();h=a.instructions;ac=a.description;e=aq.find("quantity_str").text();X='<div id="added-box"><div id="box-pic">'+Y+'</div><div id="box-info"><p id="box-quantity">'+r+": "+e+'</p><p class="strong">Pickup location</p><p id="box-location">'+s+'</p><p style="text-align:center;"><a href="http://maps.google.com/maps?q='+s+"&amp;ll="+O+","+G+'" target="_blank"><img src="http://maps.google.com/maps/api/staticmap?center='+O+","+G+"&amp;zoom=15&amp;size=300x150&amp;maptype=roadmap&amp;markers="+O+","+G+'&amp;sensor=true" width="300" height="150"></a></p></div>';extras=aq.find("extra");if(h!=""){X+='<div id="box-instructions"><p class="strong">Instructions</p><p>'+h+"</p></div>";}if(ac!=""){X+='<div id="box-description"><p class="strong">Description</p><p>'+ac+"</p></div>";}X+='<hr><div id="what-to-do"><p>Write this number on your container of goods, then press share so that they can be publicly listed.</p><p id="box-number">'+ag+'</p><form action="'+hu+'/give/" method="post">';extras.each(function(){xtra=jQuery(this).find("name").text();X+='<p><input style="display:inline;width:auto;margin:4px;" type="checkbox" name="'+xtra+'" value="yes" />'+jQuery(this).find("label").text()+"</p>";});X+='<input type="hidden" name="box_post" value="'+af+'" /><input type="hidden" name="action" value="finalize" /><p><input id="share_it" type="submit" value="Share It" /></p></form></div></div>';back2={contentHTML:g.html(),submenu:false,bar:false};g.html(X);}else{if(a.subaction=="finish_sharing"){if(am.length==0){ap={action:"fc_load_give",subaction:"get_list",note:"show",clean_slate:"true"};get_wp_data("GET",ap);}else{if(aj.length==0){jQuery("input#share_it").before("<p class='error-message'></p>");aj=jQuery("p.error-message");}aj.html(ab);}}else{if(a.subaction=="create_new_good_type"){if(am.length==0){back=2;back2={contentHTML:jQuery("#content").html(),bar:false,submenu:false};gt=aq.find("post").text();jQuery("div.search-bar").remove();jQuery("body").removeClass("with-bar");o=a.good_units;jQuery("#content").html('<div id="add-box"><form action="'+hu+'/give/" method="post"><p class="note strong">Giving '+r+':</p><p class="label">Quantity Units</p><p><select id="good_units" name="good_units" onchange="if(this.value == \'other\'){jQuery(\'.show-for-other\').show();jQuery(\'input.show-for-other\').focus();}else jQuery(\'.show-for-other\').hide();"><option value="">'+r+'</option><option value="oz">oz(s)</option><option value="lb">lb(s)</option><option value="bag">bag(s)</option><option value="box">box(es)</option><option value="can">can(s)</option><option value="jar">jar(s)</option><option value="other">other</option></select></p><p><span class="explanation show-for-other" style="display:none;">How do you count this good?</span><input type="text" class="show-for-other" style="display:none;" id="good_units_other" name="good_units_other" value="'+o+'" /></p><p class="label">Quantity</p><p><span class="explanation">How much have you got?</span><input id="quantity" type="number" name="quantity" value="" /></p><p class="label">Address<br /></p><p><span class="explanation explanation-small">What is the drop off address? (street, city)</span><input type="text" id="location" name="location" value="" /></p><p class="label">Pickup Instructions</p><p><span class="explanation explanation-small">How do I find it? (e.g. behind the front desk)</span><input id="instructions" type="text" name="instructions" value="" /></p><p class="label">Description</p><p><span class="explanation">What\'s special about your goods?</span><input type="text" id="description" name="description" value="" /></p><input type="hidden" name="good_name" value="'+r+'" /><input type="hidden" name="good_type_post" value="'+gt+'" /><input type="hidden" name="action" value="confirm" /><input class="submit" type="submit" name="create_box" value="Continue" /></form></div>');loadLocationAndReverse(jQuery("input#location"));}else{if(aj.length==0){jQuery("input#share_it").before("<p class='error-message'></p>");aj=jQuery("p.error-message");}aj.html(ab);}}}}}}else{if(a.action=="fc_load_profile"){aa=aq.find("user");if(a.subaction=="get_info"){back=0;jQuery("body").removeClass("with-bar with-submenu with-submenu-and-bar");jQuery("#back-button").remove();jQuery("div.search-bar").remove();jQuery("ul.submenu").remove();Z=aq.find("shared").find("box");ae=aq.find("foraged").find("res");n=aq.find("activity").find("box");J=aq.find("profile_pic").text();O=aa.find("latitude").text();G=aa.find("longitude").text();Y=TEMPLATE_URL+"/img/person.png";if(!t.is(".current")){jQuery("#nav-menu a").removeClass("current");t.addClass("current");}if(J!=""){Y=J;}g.html("");q.before('<form action="'+hu+'/profile/" method="post" class="top-right-button"><input type="hidden" name="action" value="edit"><input id="edit_profile" type="submit" value="Settings"></form>');X='<div id="user-info"><div id="user-pic"><img src="'+Y+'" width="44" height="44" alt="person" title="person"></div><h3>'+aa.find("display_name").text()+'</h3><p class="user-bio">'+aa.find("bio").text()+"</p>";X+='<h1>History</h1><div id="user-history">';if(n.length==0){X+="<p>Nothing yet.</p>";}else{n.each(function(){var d=jQuery(this);if(d.find("post_type").text()=="fcboxes"){X+='<div class="box-o-goods profile-shared-box'+j+'"><div class="box-pic">'+d.find("pic").text()+'</div><div class="box-info"><form action="'+hu+'/profile/" method="post"><input type="hidden" name="box_post" value="'+d.find("box_post").text()+'"><input type="hidden" name="action" value="edit_shared"><p>'+d.find("good_name").text()+": "+d.find("quantity_str").text()+"<br />"+d.find("status_msg").text()+'<br /><span class="history-date">Given '+d.find("date_str").text()+'</span> <input type="submit" value="Detail" ></p></form></div></div>';}else{X+='<div class="box-o-goods foraged-box'+j+'"><div class="box-pic">'+d.find("pic").text()+'</div><div class="box-info"><form action="'+hu+'/profile/" method="post"><input type="hidden" name="reservation" value="'+d.find("reservation").text()+'"><input type="hidden" name="claim_quantity" value="'+d.find("claim_quantity").text()+'"><input type="hidden" name="action" value="take"><input type="hidden" name="box_post" value="'+d.find("box_post").text()+'"><p>'+d.find("good_name").text()+": "+d.find("quantity_str").text()+"<br />"+d.find("status_msg").text()+'<br /><span class="history-date">Foraged '+d.find("date_str").text()+'</span> <input type="submit" value="Comment" ></p></form></div></div>';}j=" line-above";});}X+="</div>";X+="</div></div>";g.html(X);if(a.note=="removed"){g.prepend("<p class='finalized-notice'>Okay, your box has been taken off the list.</p>");animateNotice("2.5em");}if(a.note=="updated"){g.prepend("<p class='finalized-notice'>Changes saved.</p>");animateNotice("1.25em");}}else{if(a.subaction=="edit_shared"||a.subaction=="edit_foraged"){back=1;back1={contentHTML:g.html(),submenu:false,bar:false,rightbtn:jQuery(".top-right-button").clone().wrap("<div></div>").parent().html(),leftbtn:jQuery(".top-left-button").clone().wrap("<div></div>").parent().html()};addBackButton();jQuery(".top-right-button").add(".top-left-button").remove();ag=p.find("box_number").text();r=p.find("good_name").text();e=p.find("quantity_str").text();s=p.find("location").text();O=p.find("latitude").text();G=p.find("longitude").text();h=p.find("instructions").text();ac=p.find("description").text();Y=p.find("pic").text();l=p.find("comment");af=a.box_post;X='<div id="shared-box"><div id="box-pic">'+Y+'</div><div id="box-info"><p id="box-quantity">'+r+": "+e+'</p><p class="strong">Pickup location</p><p id="box-location">'+s+"</p>";if(O!=""&&G!=""){X+='<p style="text-align:center;"><a href="http://maps.google.com/maps?q='+s+"&ll="+O+","+G+'" target="_blank"><img width="300" height="150" src="http://maps.google.com/maps/api/staticmap?center='+O+","+G+"&zoom=15&size=300x150&maptype=roadmap&markers="+O+","+G+'&sensor=true"></a></p>';}X+="</div>";if(h!=""){X+='<div id="box-instructions"><p class="strong">Instructions</p><p>'+h+"</p></div>";}if(ac!=""){X+='<div id="box-description"><p class="strong">Description</p><p>'+ac+"</p></div>";}if(a.subaction=="edit_shared"){X+='<div id="what-to-do"><p class="strong">Box number</p><p id="box-number">'+ag+"</p></div>";}X+='<br><div id="comments">';l.each(function(){X+="<p class='comment'><strong>"+jQuery(this).find("user").text()+'</strong> says "'+jQuery(this).find("content").text()+'"</p>';});X+='</div><form action="'+hu+'/profile/" method="post" id="comment_form"><input type="hidden" name="box_post" value="'+af+'" /><input type="hidden" name="old_action" value="'+a.subaction+'" /><input type="hidden" name="action" value="comment" /><p><textarea name="comment_content" id="comment_content" rows="3" cols="30"></textarea></p><p><input id="post_comment" type="submit" value="Add Comment" /></p></form>';if(a.subaction=="edit_shared"){X+='<form action="'+hu+'/profile/" method="post"><input type="hidden" name="box_post" value="'+af+'" /><input type="hidden" name="action" value="remove_box" /><p><input id="remove_shared_box" type="submit" value="Remove this box" /></p></form>';}X+="</div>";g.html(X);}else{if(a.subaction=="add_comment"){I=aa.text();if(I){jQuery("div#comments").prepend("<p class='comment'><strong>"+I+'</strong> says "'+a.comment_content+'"</p>');jQuery("textarea[name=comment_content]").val("");}}else{if(a.subaction=="remove_shared"){if(am.length==0){ap={action:"fc_load_profile",subaction:"get_info",note:"removed"};get_wp_data("GET",ap);}else{if(aj.length==0){jQuery("input#remove_shared_box").before("<p class='error-message'></p>");aj=jQuery("p.error-message");}aj.html(ab);}}else{if(a.subaction=="edit_info"){if(a.from!="home"){back=1;back1={contentHTML:g.html(),submenu:false,bar:false,rightbtn:jQuery(".top-right-button").clone().wrap("<div></div>").parent().html(),leftbtn:jQuery(".top-left-button").clone().wrap("<div></div>").parent().html()};addBackButton();}jQuery(".top-right-button").add(".top-left-button").remove();R=aa.find("username").text();U=aa.find("id").text();H=aa.find("first_name").text();L=aa.find("last_name").text();ak=aa.find("email").text();an=aa.find("bio").text();x=aa.find("affiliation").text();y=aa.find("address").text();w=aa.find("search_radius").text();ao=aa.find("nonce").text();m=aq.find("logout_url").text();W=aa.find("extra");W.each(function(){B+=jQuery(this).text();});g.html('<div id="user-info"><div id="logout"><p><a href="'+m+'">Logout</a></p></div><form id="your-profile" method="post" action="'+HOME_URL+'/profile/" class="profile-form">'+ao+'<table class="form-table"><tbody><tr><th><label for="user_login">Username</label></th><td><input type="text" name="user_login_cannot_change" id="user_login_cannot_change" value="'+R+'" disabled="disabled" class="regular-text"></td></tr><tr><th><label for="first_name">First Name</label></th><td><input type="text" name="first_name" id="first_name" value="'+H+'" class="regular-text"></td></tr><tr><th><label for="last_name">Last Name</label></th><td><input type="text" name="last_name" id="last_name" value="'+L+'" class="regular-text"></td></tr><tr><th><label for="email">E-mail <span class="description">(required)</span></label></th><td><input type="text" name="email" id="email" value="'+ak+'" class="regular-text"></td></tr><tr><th><label for="address">Default Location</label></th><td><input type="text" name="address" id="address" value="'+y+'" class="regular-text"></td></tr><tr><th><label for="search_radius">Default Search Radius</label></th><td><input type="text" name="search_radius" id="search_radius" value="'+w+'" class="regular-text"><span class="description">(in miles)</span></td></tr><tr><th><label for="description">Biographical Info</label></th><td><textarea name="description" id="description" rows="5" cols="30">'+an+'</textarea> <span class="description">Share a little biographical information to fill out your profile. This will be shown publicly.</span></td></tr><tr><th><label for="affiliation">Affiliation</label></th><td><input type="text" name="affiliation" id="affiliation" value="'+x+'" class="regular-text"> <span class="description">If you are affiliated with a particular foraging group (e.g. Forage Oakland), you can note that here.</span></td></tr><tr id="password"><th><label for="pass1">New Password</label></th><td><input type="password" name="pass1" id="pass1" size="16" value="" autocomplete="off"> <span class="description">If you would like to change your password, type a new one. Otherwise leave this blank.</span><br><input type="password" name="pass2" id="pass2" size="16" value="" autocomplete="off"> <span class="description">Type your new password again.</span></td></tr>'+B+'</tbody></table><input type="hidden" name="from" value="profile"><input type="hidden" name="action" value="update"><input type="hidden" name="user_id" id="user_id" value="'+U+'"><p class="submit"><input type="submit" id="save_profile_edits" class="button-primary" value="Update Profile"></p></form><form id="cancel_profile_edit" method="post" action="'+HOME_URL+'/profile/" class="profile-form"><p class="submit"><input type="submit" class="button-primary" value="Cancel"></p></form></div>');}else{if(a.subaction=="save_edits"){if(am.length==0){ap={action:"fc_load_profile",subaction:"get_info",note:"updated"};get_wp_data("GET",ap);}else{N=aq.find("message");L=N.length;al=0;ab="";N.each(function(){ab+=jQuery(this).text();if(al<L){ab+="<br />";}al++;});if(aj.length==0){jQuery("input#save_profile_edits").parent().before("<p class='error-message'></p>");aj=jQuery("p.error-message");}aj.html(ab);}}}}}}}}}}}if(am.length==0){showStuff();}scrollOff=false;}});},claimTapLock=function(a){if(a==window){return true;}if(taplock){return false;}else{taplock=true;setTimeout("taplock=false",50);return true;}},initialize=function(){var a=jQuery("ul.submenu"),g=jQuery("div.search-bar"),e=jQuery("body"),f=jQuery("div#back-button"),i=jQuery("#scroll-wrapper"),j="click",b,c,h,d;if(hasTouch){j="touchend";}if(f.length>0){f.insertBefore(i);}if(g.length>0){g.insertBefore(i);e.addClass("with-bar");}if(a.length>0){a.insertBefore(i);e.addClass("with-submenu");if(g.length>0){e.addClass("with-submenu-and-bar");}}if(window.navigator.standalone){e.addClass("fullscreen");}jQuery("body").delegate("input","focus",function(){clearTimeout(fixScroll);jQuery(this).siblings("span.explanation").addClass("explanation-hidden");});jQuery("body").delegate("input","blur",function(){fixScroll=setTimeout(function(){window.scrollTo(0,1);},100);if(this.value==""){jQuery(this).siblings("span.explanation").removeClass("explanation-hidden");}});i.delegate("input[type=submit]","touchstart",function(k){tm=false;});i.delegate("input[type=submit]","touchmove",function(k){tm=true;});i.delegate("input[type=submit]","click",function(k){k.preventDefault();k.stopPropagation();return false;});i.delegate("input[type=submit]",j,function(P,v){if(claimTapLock(this)&&!tm){P.preventDefault();var B=jQuery(this),o=B.parents("form").first(),I=jQuery("div#content"),r="",m,S,w,L,G,A,E,z,x,p,M,N,C,F,R,K,u,J,s,y,k,n,O,H,Q,D;if(B.is("div.find-box div.box-info input")){data={action:"fc_load_find",subaction:"box_detail",box_post:o.find("input[name=box_post]").val()};get_wp_data("GET",data);}else{if(B.is("input#add_to_wishlist")){data={action:"fc_load_find",subaction:"add_to_wishlist",good_type:o.find("input[name=good_type]").val(),box_post:o.find("input[name=box_post]").val()};get_wp_data("POST",data);}else{if(B.is("input#remove_from_wishlist")){data={action:"fc_load_find",subaction:"remove_from_wishlist",good_type:o.find("input[name=good_type]").val(),box_post:o.find("input[name=box_post]").val()};get_wp_data("POST",data);}else{if(B.is("input#reserve_lot")){S=o.find("input[name=box_post]").val();w=o.find("input[name=claim_quantity]").val();if(w!=""){data={action:"fc_load_find",subaction:"reserve",box_post:S,claim_quantity:w};get_wp_data("POST",data);}}else{if(B.is("div.basket-box div.box-info input")){data={action:"fc_load_basket",subaction:"get_detail",reservation:o.find("input[name=reservation]").val()};get_wp_data("GET",data);}else{if(B.is("div.box-to-claim div.pickup input")){m=o.find("input[name=box_number]").val();data={action:"fc_load_basket",subaction:"take",reservation:o.find("input[name=reservation]").val(),taking_quantity:o.find("input[name=taking_quantity]").val(),box_number:m};get_wp_data("POST",data);}else{if(B.is("form#reservation-release-form input")){data={action:"fc_load_basket",subaction:"release",reservation:o.find("input[name=reservation]").val()};get_wp_data("POST",data);}else{if(B.is("form#reservation-problem-form input")){A=o.find("input:radio[name=problem]:checked").val();if(A){data={action:"fc_load_basket",subaction:"flag",reservation:o.find("input[name=reservation]").val(),problem:A,other_problem:o.find("input[name=other_problem]").val()};get_wp_data("POST",data);}}else{if(B.is("div.give-box div.box-info input")){back=1;back1={bar:jQuery("div.search-bar").clone(),contentHTML:jQuery("#content").html(),submenu:false};addBackButton();L=o.find("input[name=good_name]").val();G=o.find("input[name=good_type_post]").val();jQuery("div.search-bar").remove();jQuery("body").removeClass("with-bar");hideStuff();jQuery("#content").html('<div id="add-box"><form action="'+hu+'/give/" method="post"><p class="note strong">Giving '+L+':</p><p class="label">Quantity Units</p><p><select id="good_units" name="good_units" onchange="if(this.value == \'other\'){jQuery(\'.show-for-other\').show();jQuery(\'input.show-for-other\').focus();}else jQuery(\'.show-for-other\').hide();"><option value="">'+L+'</option><option value="oz">oz(s)</option><option value="lb">lb(s)</option><option value="bag">bag(s)</option><option value="box">box(es)</option><option value="can">can(s)</option><option value="jar">jar(s)</option><option value="other">other</option></select></p><p><span class="explanation show-for-other" style="display:none;">How do you count this good?</span><input type="text" class="show-for-other" style="display:none;" id="good_units_other" name="good_units_other" value="" /></p><p class="label">Quantity</p><p><span class="explanation">How much have you got?</span><input id="quantity" type="number" name="quantity" value="" /></p><p class="label">Address<br /></p><p><span class="explanation explanation-small">What is the drop off address? (street, city)</span><input type="text" id="location" name="location" value="" /></p><p class="label">Pickup Instructions</p><p><span class="explanation explanation-small">How do I find it? (e.g. behind the front desk)</span><input id="instructions" type="text" name="instructions" value="" /></p><p class="label">Description</p><p><span class="explanation">What\'s special about your goods?</span><input type="text" id="description" name="description" value="" /></p><input type="hidden" name="good_name" value="'+L+'" /><input type="hidden" name="good_type_post" value="'+G+'" /><input type="hidden" name="action" value="confirm" /><input class="submit" type="submit" name="create_box" value="Continue" /></form></div>');loadLocationAndReverse(jQuery("input#location"));showStuff();}else{if(B.is("div#add-box input")){E=o.find("select[name=good_units]");z=o.find("input[name=good_units_other]");x=z.val();p=o.find("input[name=instructions]");M=p.val();N=o.find("input[name=description]");C=N.val();F=o.find("input[name=quantity]");R=F.val();K=o.find("input[name=location]");u=K.val();J=o.find("input[name=latitude]");s=J.val();y=o.find("input[name=longitude]");k=y.val();n="1.25em";if(R==""||typeof R=="undefined"){r="Quantity is required.";}if(s==""||k==""||typeof s=="undefined"||typeof k=="undefined"){s="";k="";}if(u==""||typeof u=="undefined"){u=s+","+k;}if(u==","){if(r==""){r="Drop off address is required.";}else{r+="<br />Drop off address is required.";n="2.5em";}}if(r==""){data={action:"fc_load_give",subaction:"create_box_post",good_name:o.find("input[name=good_name]").val(),good_units:E.val(),good_units_other:x,quantity:R,location:u,latitude:s,longitude:k,instructions:M,description:C,good_type_post:o.find("input[name=good_type_post]").val()};E.find("option:selected").attr("selected","selected");z.attr("value",x);F.attr("value",R);K.attr("value",u);J.attr("value",s);y.attr("value",k);p.attr("value",M);N.attr("value",C);back=2;back2={contentHTML:I.html(),bar:false,submenu:false};get_wp_data("POST",data);}else{I.prepend("<p class='finalized-notice error'>"+r+"</p>");animateNotice(n);}}else{if(B.is("div#create-good-type input")){back=1;back1={bar:jQuery("div.search-bar").clone(),contentHTML:jQuery("#content").html(),submenu:false};addBackButton();L=o.find("input[name=good_name]").val();jQuery("div.search-bar").remove();jQuery("body").removeClass("with-bar");hideStuff();jQuery("#content").html('<div id="save-good-type"><form action="'+hu+'/give/" method="post"><input type="hidden" name="good_name" value="'+L+'" /><p class="label">Quantity Units</p><p><select id="good_units" name="good_units" onchange="if(this.value == \'other\'){jQuery(\'.show-for-other\').show();jQuery(\'input.show-for-other\').focus();}else jQuery(\'.show-for-other\').hide();"><option value="">'+L+'</option><option value="oz">oz(s)</option><option value="lb">lb(s)</option><option value="bag">bag(s)</option><option value="box">box(es)</option><option value="can">can(s)</option><option value="jar">jar(s)</option><option value="other">other</option></select></p><p><span class="explanation show-for-other" style="display:none;">How do you count this good?</span><input type="text" class="show-for-other" style="display:none;" id="good_units_other" name="good_units_other" value="'+E+'" /></p><input type="hidden" name="action" value="save_new_good_type" /><input type="submit" value="Continue" /></form></div>');showStuff();}else{if(B.is("div#save-good-type input")){data={action:"fc_load_give",subaction:"create_new_good_type",good_name:o.find("input[name=good_name]").val(),good_units:o.find("input[name=good_units]").val(),};get_wp_data("POST",data);}else{if(B.is("div#what-to-do input")){L=jQuery("p#box-quantity").text();H=L.replace(/.*: /,"");O=H;Q=new Array();D=new Array();if(H.replace(/[0-9 ]*/,"")!=""){O+=" of";}O+=" "+L.replace(/: [^:]*$/,"");data={action:"fc_load_give",subaction:"finish_sharing",good_info:O,box_post:o.find("input[name=box_post]").val()};extras.each(function(){var q=jQuery(this).find("name").text(),l="no";Q.push(q);if(o.find("input[name="+q+"]:checked").val()=="yes"){l="yes";}D.push(l);});data.extra_names=Q.join(";");data.extra_values=D.join(";");get_wp_data("POST",data);}else{if(B.is("div.foraged-box input")){data={action:"fc_load_profile",subaction:"edit_foraged",box_post:o.find("input[name=box_post]").val()};get_wp_data("GET",data);}else{if(B.is("div.profile-shared-box input")){data={action:"fc_load_profile",subaction:"edit_shared",box_post:o.find("input[name=box_post]").val()};get_wp_data("GET",data);}else{if(B.is("#post_comment")){data={action:"fc_load_profile",subaction:"add_comment",comment_content:o.find("textarea[name=comment_content]").val(),box_post:o.find("input[name=box_post]").val()};get_wp_data("GET",data);}else{if(B.is("#remove_shared_box")){data={action:"fc_load_profile",subaction:"remove_shared",box_post:o.find("input[name=box_post]").val()};get_wp_data("GET",data);}else{if(o.is("#cancel_profile_edit")){if(back==1){jQuery("div#back-button input[type=submit]").click();}else{get_wp_data("GET",{action:"fc_load_profile",subaction:"get_info"});}}else{if(B.is("#edit_profile")){d(P,"edit_info");}else{if(B.is("#save_profile_edits")){data={action:"fc_load_profile",subaction:"save_edits",user_login_cannot_change:o.find("input[name=user_login_cannot_change]").val(),first_name:o.find("input[name=first_name]").val(),last_name:o.find("input[name=last_name]").val(),email:o.find("input[name=email]").val(),address:o.find("input[name=address]").val(),search_radius:o.find("input[name=search_radius]").val(),pass1:o.find("input[name=pass1]").val(),pass2:o.find("input[name=pass2]").val(),user_id:o.find("input[name=user_id]").val(),description:o.find("textarea[name=description]").val(),affiliation:o.find("input[name=affiliation]").val(),from:"profile",};get_wp_data("POST",data);}else{if(!B.is("div.foraged-box input")){o.submit();}}}}}}}}}}}}}}}}}}}}}return false;}else{return true;}});jQuery("body").delegate("ul.submenu li a","click touchend",function(m){if(!claimTapLock(this)){m.preventDefault();return false;}var k=jQuery(this),l=k.parent().is(".current");if(k.is("ul.submenu li a")){jQuery("ul.submenu li").removeClass("current");k.parent().addClass("current");}if(k.is("li#sort-by-wishlist a")){m.preventDefault();data={action:"fc_load_find",subaction:"get_list",good_name:jQuery("input[name=good_name]").val(),sort_by:"wishlist"};get_wp_data_with_loc("GET",data);return false;}else{if(k.is("li#sort-by-recent a")){m.preventDefault();data={action:"fc_load_find",subaction:"get_list",sort_by:"recent",good_name:jQuery("input[name=good_name]").val()};get_wp_data_with_loc("GET",data);return false;}else{if(k.is("li#sort-by-map a")){m.preventDefault();data={action:"fc_load_find",subaction:"get_list",sort_by:"nearby",good_name:jQuery("input[name=good_name]").val()};if(l){jQuery("ul.submenu li#sort-by-map").attr("id","sort-by-nearby");k.attr("href",hu+"/find/nearby/");data.sort_by="map";}get_wp_data_with_loc("GET",data);return false;}else{if(k.is("li#sort-by-nearby a")){m.preventDefault();data={action:"fc_load_find",subaction:"get_list",sort_by:"map",good_name:jQuery("input[name=good_name]").val()};if(l){jQuery("ul.submenu li#sort-by-nearby").attr("id","sort-by-map");k.attr("href",hu+"/find/map/");data.sort_by="nearby";}get_wp_data_with_loc("GET",data);return false;}}}}});jQuery("body").delegate("div#good-type-search.find input[name=good_name]","keyup input",function(k){k.preventDefault();clearTimeout(keyTO);keyTO=setTimeout(function(){var l=jQuery("input[name=good_name]").val();lastgn=l;data={action:"fc_load_find",subaction:"get_list",good_name:l};if(jQuery("ul.submenu li#sort-by-recent").is(".current")){data.sort_by="recent";}else{if(jQuery("ul.submenu li#sort-by-nearby").is(".current")){data.sort_by="map";}else{if(jQuery("ul.submenu li#sort-by-map").is(".current")){data.sort_by="nearby";}else{if(jQuery("ul.submenu li#sort-by-wishlist").is(".current")){data.sort_by="wishlist";}else{data.sort_by=defaultSort;}}}}get_wp_data_with_loc("GET",data);},5);return false;});jQuery("body").delegate("div#good-type-search.find input[value=Search]",j,function(k){k.preventDefault();if(!claimTapLock(this)){return false;}clearTimeout(keyTO);keyTO=setTimeout(function(){var l=jQuery("input[name=good_name]").val();lastgn=l;data={action:"fc_load_find",subaction:"get_list",good_name:l};if(jQuery("ul.submenu li#sort-by-recent").is(".current")){data.sort_by="recent";}else{if(jQuery("ul.submenu li#sort-by-nearby").is(".current")){data.sort_by="map";}else{if(jQuery("ul.submenu li#sort-by-map").is(".current")){data.sort_by="nearby";}else{if(jQuery("ul.submenu li#sort-by-wishlist").is(".current")){data.sort_by="wishlist";}else{data.sort_by=defaultSort;}}}}get_wp_data_with_loc("GET",data);},5);return false;});jQuery("body").delegate("div#good-type-search.give input[name=good_name]","keyup input",function(l){l.preventDefault();var k=jQuery(this).val();lastgn=k;data={action:"fc_load_give",subaction:"get_list",good_name:k};get_wp_data("GET",data);return false;});jQuery("body").delegate("div#good-type-search.give input[value=Search]",j,function(l){l.preventDefault();if(!claimTapLock(this)){return false;}var k=jQuery("input[name=good_name]").val();lastgn=k;data={action:"fc_load_give",subaction:"get_list",good_name:k};get_wp_data("GET",data);return false;});b=function(k){k.preventDefault();if(!claimTapLock(this)){return false;}jQuery("#container").attr("class","give");if(!jQuery(this).is(".current")||jQuery("div#back-button").length>0){data={action:"fc_load_give",subaction:"get_list",clean_slate:"true"};get_wp_data("GET",data);}return false;};c=function(m,l){m.preventDefault();var k=claimTapLock(this);if(!k){return false;}jQuery("#container").attr("class","find");if(!jQuery(this).is(".current")||!jQuery("body").is(".with-submenu-and-bar")){data={action:"fc_load_find",subaction:"get_list",clean_slate:"true"};if(l==undefined){data.sort_by="wishlist";}else{data.sort_by=l;}get_wp_data_with_loc("GET",data);}return false;};h=function(k){k.preventDefault();if(!claimTapLock(this)){return false;}jQuery("#container").attr("class","basket");if(!jQuery(this).is(".current")||jQuery("div#back-button").length>0){data={action:"fc_load_basket",subaction:"get_list"};get_wp_data("GET",data);}return false;};d=function(l,k,m){l.preventDefault();if(!claimTapLock(this)){return false;}jQuery("#container").attr("class","profile");if(!jQuery(this).is(".current")||jQuery("div#back-button").length>0){data={action:"fc_load_profile"};if(k==undefined){data.subaction="get_info";}else{data.subaction=k;}if(m!=undefined){data.from=m;}get_wp_data("GET",data);}return false;};jQuery("#nav-menu a").not("a[title=profile]").bind(j,function(k){jQuery(".top-right-button").add(".top-left-button").remove();});jQuery("#nav-menu a[title=give]").bind(j,b);jQuery("body").delegate("#give_button","click touchend",b);jQuery("#nav-menu a[title=find]").bind(j,c);jQuery("body").delegate("#wishlist_button","click touchend",c);jQuery("body").delegate("#recent_button","click touchend",function(k){c(k,"recent");});jQuery("body").delegate("#nearby_button","click touchend",function(k){c(k,"nearby");});jQuery("body").delegate("#map_button","click touchend",function(k){c(k,"map");});jQuery("#nav-menu a[title=basket]").bind(j,h);jQuery("body").delegate("#checkout_button","click touchend",h);jQuery("#nav-menu a[title=profile]").bind(j,d);jQuery("body").delegate("#settings_button","click touchend",function(k){d(k,"edit_info","home");});jQuery("#nav-menu a[title=home]").add("div#home-button a").add("div#info-close-button a").bind(j,function(k){k.preventDefault();if(!claimTapLock(this)){return false;}jQuery(".top-right-button").add(".top-left-button").remove();jQuery("#container").attr("class","homemenu");jQuery("#nav-menu a").removeClass("current");jQuery(this).addClass("current");jQuery("div.search-bar").add("ul.submenu").remove();jQuery("body").removeClass("with-bar with-submenu with-submenu-and-bar");hideStuff();jQuery("#content").html('<div id="home_menu"><a id="nearby_button" href="'+hu+'/find/nearby/"><span>Nearby</span></a><a id="map_button" class="right" href="'+hu+'/find/map/"><span>Nearby/Map</span></a><a id="give_button" href="'+hu+'/give/"><span>Give</span></a><a id="checkout_button" class="right" href="'+hu+'/basket/"><span>Check Out</span></a><a id="wishlist_button" href="'+hu+'/find/wishlist/"><span>Wishlist</span></a><a id="settings_button" class="right" href="'+hu+'/profile/edit/"><span>Settings</span></a><div style="clear:both;"></div></div>');jQuery("div#top-buttons").addClass("homemenu").removeClass("page");showStuff();return false;});jQuery("body").delegate("#back-button input","touchstart",function(){top_btn=true;});jQuery("body").delegate("#back-button input","touchmove",function(){top_btn=false;});jQuery("body").delegate("#back-button input",j,function(k){k.preventDefault();if(!claimTapLock(this)){return false;}if(top_btn||!hasTouch){hideStuff();if(back==1){jQuery("#content").html(back1.contentHTML);if(back1.bar){i.before(back1.bar);jQuery("body").addClass("with-bar");}if(back1.submenu){i.before(back1.submenu);jQuery("body").addClass("with-submenu");if(back1.bar){jQuery("body").addClass("with-submenu-and-bar");}}if(back1.rightbtn){i.before(back1.rightbtn);}if(back1.leftbtn){i.before(back1.leftbtn);}jQuery("#back-button").remove();var l=250;if(iOS){l=0;}setTimeout('jQuery("div#container").removeClass("with-back-button");',l);}else{if(back==2){jQuery("#content").html(back2.contentHTML);if(back2.bar){i.before(back2.bar);jQuery("body").addClass("with-bar");}if(back2.submenu){i.before(back2.submenu);jQuery("body").addClass("with-submenu");if(back2.bar){jQuery("body").addClass("with-submenu-and-bar");}}if(back2.rightbtn){i.before(back2.rightbtn);}if(back2.leftbtn){i.before(back2.leftbtn);}}}back--;backHelper();showStuff();}top_btn=false;return false;});jQuery("#branding a").bind("click touchend",function(k){k.preventDefault();return false;});setTimeout(delayedInit,100);},delayedInit=function(){if(navigator.userAgent.match(/Android/i)){window.scrollTo(0,0);var a=jQuery(document).height(),b=window.outerHeight;if(b>a){b-=250;}jQuery("body").addClass("android");}window.scrollTo(0,1);if(iOS){myScroll=new iScroll("scroll-wrapper",{onBeforeScrollStart:function(f){if(iOS){f.preventDefault();}else{var d=f.target,c;while(d.nodeType!=1){d=d.parentNode;}c=d.tagName.toUpperCase();if(c!="SELECT"&&c!="INPUT"&&c!="TEXTAREA"&&c!="LABEL"){f.preventDefault();}}}});}else{jQuery("body").addClass("not-iOS").css("height",jQuery(window).height()+"px");fixScrollWrapper();fixFooter();}};jQuery(function(){var a,b;document.documentElement.className=document.documentElement.className.replace(/\bno-js\b/,"");document.addEventListener("click touchend",function(c){c.stopPropagation();},false);if(!(navigator.userAgent.match(/iPhone/i))&&!(navigator.userAgent.match(/iPod/i))&&!(navigator.userAgent.match(/iPad/i))){iOS=false;}initialize();if(jQuery("li#sort-by-nearby").is(".current")){b={action:"fc_load_find",subaction:"get_list",clean_slate:"true",sort_by:"map"};get_wp_data_with_loc("GET",b);}if(!iOS){a=document.getElementById("scroll-wrapper"),supportsOrientationChange="onorientationchange" in window,orientationEvent=supportsOrientationChange?"orientationchange":"resize";jQuery(window).bind(orientationEvent,function(){setTimeout("fixFooter();",100);});a.ontouchstart=a.ontouchmove=function(){if(jQuery("#scroll-wrapper").height()>jQuery("body").height()){jQuery("#footer").css({top:"auto",bottom:"0"});}};a.ontouchend=function(){fixFooter();};window.onscroll=fixFooter;}});